{% extends "base.html" %}
{% block content %}


<div class="container mx-auto p-4">


<!-- Form for selecting text -->
<form action="{% url 'corpus:tokens' %}" method="get" class="mb-4">
  <!-- Text selection dropdown -->
  <div class="mb-3">
    <label for="text-select" class="block text-gray-700 text-sm font-bold mb-2">Choose a text:</label>
    <select name="text_id" id="text-select" onchange="this.form.submit()"
      class="block appearance-none w-full bg-white border border-gray-400 hover:border-gray-500 px-4 py-2 pr-8 rounded shadow leading-tight focus:outline-none focus:shadow-outline">
      <option value="">Select a text...</option>
      {% for text in texts %}
      <option value="{{ text.id|stringformat:"s" }}" {% if text.id|stringformat:"s" == selected_text_id|stringformat:"s" %}selected{% endif %}>
        {{ text.title }}
      </option>
      {% endfor %}
    </select>
  </div>
  <noscript><input type="submit" value="Filter" class="btn btn-primary"></noscript>
</form>


<!-- Table for displaying tokens -->
<table class="min-w-full bg-white mt-6">
  <thead class="bg-gray-800 text-white">
    <tr>
      <th class="px-4 py-2">Number</th>
      <th class="px-4 py-2">Transcription</th>
      <th class="px-4 py-2">Transliteration</th>
      <th class="px-4 py-2">Lemmas</th>
      <th class="px-4 py-2">Senses</th>
      <th class="px-4 py-2" colspan="3">Actions</th> <!-- Note the colspan here for spanning three columns -->
    </tr>
  </thead>
  <tbody>
    {% for token in tokens %}
    <tr class="bg-white shadow-lg rounded mb-4 overflow-hidden">
      <!-- Form for the entire row to edit a token -->
      <form method="post" action="{% url 'corpus:update_token' %}">
        {% csrf_token %}
        <td class="border px-4 py-2">{{ token.number }}</td>
        <td class="border px-4 py-2">
          <input type="text" name="transcription" value="{{ token.transcription }}"
            class="shadow border rounded py-2 px-3 text-grey-darker">
        </td>
        <td class="border px-4 py-2">
          <input type="text" name="transliteration" value="{{ token.transliteration }}"
            class="shadow border rounded py-2 px-3 text-grey-darker">
        </td>
        <td class="border px-4 py-2">
          <select name="lemmas" multiple class="shadow border rounded py-2 px-3">
            {% for lemma in token.lemmas.all %}
            <option value="{{ lemma.id }}" {% if lemma in token.selected_lemmas %}selected{% endif %}>
              {{ lemma.word }}
            </option>
            {% endfor %}
          </select>
        </td>
        <td class="border px-4 py-2">
          <select name="senses" multiple class="shadow border rounded py-2 px-3">
            {% for sense in token.senses.all %}
            <option value="{{ sense.id }}" {% if sense in token.selected_senses %}selected{% endif %}>
              {{ sense.sense }}
            </option>
            {% endfor %}
          </select>
        </td>
        <td class="border px-4 py-2" colspan="3">
          <input type="hidden" name="token_id" value="{{ token.id }}">
          <input type="submit" value="Save Changes"
            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
        </td>
      </form>
      <!-- Insert After Button -->
      <td class="border px-4 py-2">
        <form method="post" action="{% url 'corpus:insert_after_token' token.id %}">
          {% csrf_token %}
          <input type="hidden" name="token_id" value="{{ token.id }}">
          <input type="submit" value="Insert After"
            class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
        </form>
      </td>
      <!-- Insert Before Button -->
      <td class="border px-4 py-2">
        <form method="post" action="{% url 'corpus:insert_before_token' token.id %}">
          {% csrf_token %}
          <input type="hidden" name="token_id" value="{{ token.id }}">
          <input type="submit" value="Insert Before"
            class="bg-yellow-500 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
        </form>
      </tr>
      {% empty %}
      <tr>
        <td colspan="5" class="text-center py-4">No tokens available for the selected text.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  {% endblock content %}