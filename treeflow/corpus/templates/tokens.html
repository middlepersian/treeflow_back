{% extends "base.html" %}
{% block content %}


<div class="container mx-auto p-4">
  <!-- Form for selecting text -->
  <form action="{% url 'corpus:tokens' %}" method="get" class="mb-4">
    <!-- Text selection dropdown -->
    <div class="mb-3">
      <label for="text-select" class="block text-gray-700 text-sm font-bold mb-2">Choose a text:</label>
      <select name="text_id" id="text-select" onchange="this.form.submit()"
        class="block appearance-none w-full bg-white border border-gray-400 hover:border-gray-500 px-4 py-2 pr-8 rounded shadow leading-tight focus:outline-none focus:shadow-outline">
        <option value="">Select a text...</option>
        {% for text in texts %}
        <option value="{{ text.id }}" {% if text.id == selected_text_id %} selected="selected" {% endif %}>
          {{ text.title }}
        </option>
        {% endfor %}
      </select>
    </div>
    <noscript><input type="submit" value="Filter" class="btn btn-primary"></noscript>
  </form>

  <!-- Table for displaying tokens -->
  <table class="min-w-full bg-white mt-6">
    <thead class="bg-gray-800 text-white">
      <tr>
        <th class="px-4 py-2">Transcription</th>
        <th class="px-4 py-2">Transliteration</th>
        <th class="px-4 py-2">Lemmas</th>
        <th class="px-4 py-2">Senses</th>
        <th class="px-4 py-2">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for token in tokens %}
      <tr class="bg-white shadow-lg rounded mb-4 overflow-hidden">
        <form method="post" action="{% url 'corpus:update_token' %}" class="grid grid-cols-1 gap-4 w-full">
          {% csrf_token %}
          <input type="hidden" name="token_id" value="{{ token.id }}">
          <!-- Transcription -->
          <td class="border px-4 py-2">
            <input type="text" name="transcription" value="{{ token.transcription }}"
              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
          </td>
          <!-- Transliteration -->
          <td class="border px-4 py-2">
            <input type="text" name="transliteration" value="{{ token.transliteration }}"
              class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
          </td>
          <!-- Lemmas -->
          {% if token.lemmas.exists %}
          <td class="border px-4 py-2">
            <select name="lemmas" multiple class="shadow border rounded py-2 px-3">
              {% for lemma in token.lemmas.all %}
              <option value="{{ lemma.id }}" {% if lemma in token.lemmas.all %} selected {% endif %}>{{ lemma.word }}
              </option>
              {% endfor %}
            </select>
          </td>
          {% else %}
          <td class="border px-4 py-2">-</td>
          {% endif %}
          <!-- Senses -->
          {% if token.senses.exists %}
          <td class="border px-6 py-2">
            <select name="senses" multiple class="shadow border rounded py-2 px-3">
              {% for sense in token.senses.all %}
              <option value="{{ sense.id }}" {% if sense in token.senses.all %} selected {% endif %}>{{ sense.sense }}
              </option>
              {% endfor %}
            </select>
          </td>
          {% else %}
          <td class="border px-4 py-2">-</td>
          {% endif %}
          <!-- Actions -->
          <td class="border px-4 py-2">
            <input type="submit" value="Save Changes"
              class="bg-green-500 hover:bg-blue-700 text-gray-700 font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
          </td>
        </form>
      </tr>
      {% empty %}
      <tr>
        <td colspan="5" class="text-center py-4">No tokens available for the selected text.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  {% endblock content %}