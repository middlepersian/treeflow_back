
{% block content %}
<div class="flex flex-col w-full h-screen">
  <!-- Selector container with max-width and margin auto for horizontal centering -->
  <div class="flex flex-row justify-start w-full px-4 lg:max-w-lg mx-auto">
    <select
      name="source_id"
      hx-get="{% url 'corpus:imageSelector' %}"
      hx-target="#imageSelector"
      id="sourceSelector"
      class="w-full"
      onchange="openNewImage();"
    >
      <option value="" default>Select a Source</option>
      {% for source in sources %}
      <option value="{{source.id}}">{{source.identifier}}</option>
      {% endfor %}
    </select>
    <div id="imageSelector"></div>
  </div>


<div id="viewer" class="flex flex-col w-full h-full">
  <div id="openseadragon" class="flex h-full w-full"></div>
  <script type="text/javascript">
    let viewer;
    let currentImage = "{{ manuscript_image }}";

    document.addEventListener('DOMContentLoaded', function () {
      if (currentImage) {
        initViewer(); // Initialize viewer with the first manuscript image on load
      }
    });

    function openNewImage() {
      let selector = document.getElementById('sourceSelector');
      let imageID = selector.value;
      if (imageID == "") {
        return;
      }
      let imageIdentifier = selector.selectedOptions[0].text;
      if (!imageIdentifier) {
        return;
      }
      
      currentImage = imageIdentifier;
      console.log(currentImage);
      initViewer(); 
    }

    function initViewer() {
      if (currentImage) {
        if (!viewer) {
          viewer = OpenSeadragon({
            id: "openseadragon",
            prefixUrl: "//openseadragon.github.io/openseadragon/images/",
            tileSources: `https://images.cceh.uni-koeln.de/iipsrv?IIIF=/nfs/cceh/projects/images-mpcd/${currentImage}.tif/info.json`,
            showNavigator: true,
            showNavigationControl: true,
            navigationControlAnchor: OpenSeadragon.ControlAnchor.TOP_RIGHT,
            minZoomLevel: 0.1,
            maxZoomLevel: 10,
            visibilityRatio: 1,
            constrainDuringPan: true,
            zoomPerScroll: 2,
          });
        } else {
          viewer.open(
            `https://images.cceh.uni-koeln.de/iipsrv?IIIF=/nfs/cceh/projects/images-mpcd/${currentImage}.tif/info.json`
          );
        }
      }
    }
  </script>
</div>
</div>

{% endblock %}
