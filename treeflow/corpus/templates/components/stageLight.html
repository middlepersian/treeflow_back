{% if request.user.is_authenticated %}
  <input type="hidden" value="{{ text.stage }}" />
  <div class="flex flex-row justify-center">
    <div class="flex flex-row justify-center mt-1 rounded-md" data-stage="{{ text.stage }}">
      <button class="relative inline-block outline-none group" value="untouched" name="stage" 
        hx-post="{% url 'corpus:update_text' text.id %}"
        hx-trigger="click"
        hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
        hx-swap='none'>
        {% if text.stage == 'untouched' %}
          <svg class="text-blue-500 cursor-pointer w-9 h-9" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        {% else %}
          <svg class="text-gray-400 cursor-pointer w-9 h-9 hover:text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        {% endif %}
        <div class="opacity-0 bg-main-dark-graded-900 text-white text-xs rounded-lg py-1 absolute z-10 group-hover:opacity-100 bottom-full -left-[1.25rem] mb-1 px-2 pointer-events-none">
          Untouched<svg class="absolute left-0 w-full h-2 text-main-dark-graded-900 top-full" x="0px" y="0px" viewBox="0 0 255 255">
            <polygon class="text-current" points="0,0 127.5,127.5 255,0" />
          </svg>
        </div>
      </button>
      <button class="relative inline-block outline-none group" value="" name="stage" 
        hx-post="{% url 'corpus:update_text' text.id %}"
        hx-trigger="click"
        hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
        hx-swap='none'>
        {% if text.stage == '' %}
          <svg class="w-8 h-8 cursor-pointer text-error" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10" /> <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" /> <line x1="12" y1="17" x2="12.01" y2="17" />
          </svg>
        {% else %}
          <svg class="w-8 h-8 text-gray-400 cursor-pointer hover:text-error" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10" /> <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" /> <line x1="12" y1="17" x2="12.01" y2="17" />
          </svg>
        {% endif %}
        <div class="opacity-0 bg-main-dark-graded-900 text-white text-xs rounded-lg py-1 absolute z-10 group-hover:opacity-100 bottom-full -left-[0.5rem] mb-1 px-2 pointer-events-none">
          Unset<svg class="absolute left-0 w-full h-2 text-main-dark-graded-900 top-full" x="0px" y="0px" viewBox="0 0 255 255">
            <polygon class="text-current" points="0,0 127.5,127.5 255,0" />
          </svg>
        </div>
      </button>
      <button class="relative inline-block outline-none group" value="inprogress" name="stage" 
        hx-post="{% url 'corpus:update_text' text.id %}"
        hx-trigger="click"
        hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
        hx-swap='none'>
        {% if text.stage == 'inprogress' %}
          <svg class="w-8 h-8 cursor-pointer text-action-graded-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10" /> <polygon points="10 8 16 12 10 16 10 8" />
          </svg>
        {% else %}
          <svg class="w-8 h-8 text-gray-400 cursor-pointer hover:text-action-graded-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10" /> <polygon points="10 8 16 12 10 16 10 8" />
          </svg>
        {% endif %}
        <div class="opacity-0 bg-main-dark-graded-900 text-white text-xs rounded-lg py-1 absolute z-10 group-hover:opacity-100 bottom-full -left-[1.5rem] mb-1 px-2 pointer-events-none">
          In progress<svg class="absolute left-0 w-full h-2 text-main-dark-graded-900 top-full" x="0px" y="0px" viewBox="0 0 255 255">
            <polygon class="text-current" points="0,0 127.5,127.5 255,0" />
          </svg>
        </div>
      </button>
      <div class="border border-black"></div>
      <button class="relative inline-block outline-none group" value="finished" name="stage" 
        hx-post="{% url 'corpus:update_text' text.id %}"
        hx-trigger="click"
        hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
        hx-swap='none'>
        {% if text.stage == 'finished' %}
          <svg class="text-green-600 w-9 h-9" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" /> <circle cx="12" cy="12" r="9" /> <path d="M9 12l2 2l4 -4" />
          </svg>
        {% else %}
          <svg class="text-gray-400 cursor-pointer w-9 h-9 hover:text-green-600" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" /> <circle cx="12" cy="12" r="9" /> <path d="M9 12l2 2l4 -4" />
          </svg>
        {% endif %}
        <div class="absolute z-10 px-2 py-1 mb-1 text-xs text-white rounded-lg opacity-0 pointer-events-none bg-main-dark-graded-900 group-hover:opacity-100 bottom-full -left-[0.9rem]">
          Finished<svg class="absolute left-0 w-full h-2 text-main-dark-graded-900 top-full" x="0px" y="0px" viewBox="0 0 255 255">
            <polygon class="text-current" points="0,0 127.5,127.5 255,0" />
          </svg>
        </div>
      </button>
    </div>
    {% if text.stage != 'untouched' and text.stage != '' and text.stage != 'inprogress' and text.stage != 'finished' %}
      <sup class="font-serif text-lg font-semibold text-error cursor-help" title="The current stage '{{ text.stage }}' isn't a standardised one and needs to be changed.">!</sup>
    {% endif %}
  </div>
{% else %}
  <span class="block w-full mt-1 text-center capitalize">{{ text.stage }}</span>
{% endif %}
