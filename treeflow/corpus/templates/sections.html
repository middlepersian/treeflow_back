{% extends 'base.html' %}
{% load static tailwind_tags i18n %}

{% block content %}
  <div class="flex flex-col w-full h-screen overflow-y-hidden">
    <!-- Main content and sidebar container -->
    <div class="flex w-full h-full">
      <div class="flex flex-row w-1/2">
        <!-- Sidebar -->
        <div class="w-1/4 h-full p-4 overflow-y-scroll bg-gray-100">
          <!-- Text Dropdown -->
          <div class="flex-none max-w-xs">{% include 'text_dropdown.html' with text_id=selected_text_id %}</div>
          <!-- Edit Button (Conditionally Rendered for Authenticated Users) -->
          {% if request.user.is_authenticated %}
            <button id="startTokenSelection" class="px-4 py-2 mt-4 font-bold text-white rounded bg-main hover:bg-main-dark" data-mode="select">{% trans 'Start Token Selection' %}</button>
          {% endif %}
          <!-- Sidebar Content Including Edit Button -->
          <div class="z-10 px-4 py-2 bg-gray-200 shadow-md">
            <h2 class="mb-4 text-lg font-bold">{% trans 'Select Section Type' %}</h2>
            <!-- Dropdown Menu for selecting section type -->
            <select id="sectionTypeSelector" class="mb-4">
              {% for section_type in section_types %}
                <option value="{{ section_type }}">{{ section_type|title }}</option>
              {% endfor %}
            </select>
            <!-- Section List Placeholder -->
            <div id="sectionList">
              <!-- Sections will be dynamically loaded here -->
            </div>
          </div>
        </div>

        <!-- Content Area for sentences -->
        <div class="w-3/4 overflow-y-scroll">
          <!-- Loop over sections of type 'sentence' -->
          {% for section in sentence_sections %}
            <!-- Sentence Block starts -->
            <div class="flex items-center p-2 mb-2 bg-white rounded shadow sentence">
              <!-- Display sentence section title or identifier with a fixed width -->
              <div id="{{ section.id }}" class="mr-1 font-bold sentence-identifier w-1/8">
                <a href="{% url 'corpus:ud_editor' section.id %}" class="text-main hover:text-main-dark">{{ section.number|default:'Untitled' }}</a>
              </div>

              <!-- Sentence content tokens displayed next to the identifier -->
              <div class="flex flex-wrap sentence-content w-2/8">
                {% for token in section.prefetched_tokens %}
                  <span class="token inline-block rounded px-1 py-0.5 m-0.5" data-token-id="{{ token.id }}" data-section-id="{{ section.id }}">{{ token.transcription }}</span>
                {% endfor %}
              </div>

              {% if request.user.is_authenticated %}
                <div class="mr-1 font-bold sentence-identifier w-1/8">
                  <a href="{% url 'corpus:sentence' section.id %}" class="text-xl font-bold text-off hover:text-action">&#x270F; <!-- Unicode pencil icon --></a>
                </div>
              {% endif %}
            </div>
            {% empty %}
            <p>
              {% trans 'No sentence sections found for this text.' %}
            </p>
          {% endfor %}
        </div>
      </div>

      <!-- Right Column for Image -->
      <div id="iiif-viewer" class="w-1/2 m-2">{% include 'components/OpenSeaDragon.html' with sources=manuscripts %}</div>
    </div>

    <input type="hidden" id="id_selected_tokens" name="selected_tokens" value />

    <div id="modalContainer"></div>
  </div>

  <script>
    var textId = '{{ selected_text_id }}'
    console.log('Selected text ID:', textId)
  </script>

  <script src="{% static 'corpus/section_navigator.js' %}"></script>
  <script src="{% static 'corpus/section_creator.js' %}"></script>
{% endblock %}
