
{% extends 'components/section_modal.html' %}

{% block title %}Edit Section{% endblock %}
{% block url %}{% url 'corpus:update_section' section.id %}{% endblock %}

{% block form_fields %}
    <!-- Load jQuery -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

  {{ form.media.css }}
  {{ form.media.js }}

  <input type="hidden" name="text_id" value="{{ section.text_id }}">
  <div class="space-y-4">
      <div class="form-row space-y-2">
          {% for field in form %}
          <div class="flex items-center" style="width: 100%;">
              <div class="w-1/3">{{ field.label_tag }}</div>
              <div class="w-2/3" style="width: 100%;">
                  {{ field }}
              </div>
          </div>
          {% endfor %}
          <fieldset>
              {{ comment_formset.management_form }}
              {% if comment_formset.forms %}
              {% for comment_form in comment_formset %}
              <div class="comment-form">
                  {{ comment_form.as_p }}
                  {% if comment_form.instance.comment %}
                    <p>Comment by: {{ comment_form.instance.user }}</p>
                  {% endif %}
              </div>
              <hr>
              {% endfor %}
              {% else %}
              <p>No comments available.</p>
              {% endif %}
              {{ comment_formset.non_form_errors }}
          </fieldset>
      </div>
  </div>

  <script>
    document.getElementById('section-modal').addEventListener('htmx:afterRequest', function (event) {
        if (event.detail.xhr.responseURL.includes('update_section')) {
          htmx.trigger('#section-type-selector', 'change');
          document.getElementById('section-modal').remove();
        }
    });
  </script>
{% endblock %}
